library(RSelenium)
library(rvest)
library(stringr)
library(tidyverse)
sortByDate <- function(remDr){
sortButton <- remDr$findElement(using = "css selector", ".gsc-option-menu-container.gsc-inline-block")
sortButton$clickElement()
dateButton <- sortButton$findChildElement(using = "css selector", ".gsc-option-menu .gsc-option-menu-item:last-child")
dateButton$getElementText()
remDr$mouseMoveToLocation(webElement = dateButton)
remDr$click()
}
getNews <- function(df, pageUrl, remDr) {
remDr$navigate(pageUrl)
Sys.sleep(5)
links = list()
while(length(links) == 0){
links <- remDr$findElements(using = "css selector", ".gsc-expansionArea .gsc-thumbnail-inside a:first-child")
print("getting links ...")
}
# dates <- remDr$findElements(using = "css selector", ".gs-bidi-start-align.gs-visibleUrl.gs-visibleUrl-breadcrumb span:nth-child(3)")
#
# dates <- sapply(dates, function(x) x$getElementText())
titles <- sapply(links, function(x) x$getElementText())
urls <- sapply(links, function(x) x$getElementAttribute("href"))
for(i in 1:length(urls)){
title <- titles[[i]]
url <- urls[[i]]
news <- read_html(url) %>%
html_elements(".read__content p") %>%
html_text2() %>%
paste(collapse = " ")
df <- df %>%
add_row(title, url, news)
}
df
}
